<!DOCTYPE html>
<html lang="en">
    {% include 'fragment/header.html' %}
    <body class="sb-nav-fixed">
        {% include 'fragment/nav.html' %}
        <div id="layoutSidenav">
            <div id="layoutSidenav_content">
            {% include 'fragment/sidebar.html' %}
            <div class="container-lg">
                <h1>Scatter Plot</h1>

                <!-- 카테고리별 산포도 -->
                <div class="col-xl-12">
                    <div class="card mb-4">
                        <div class="card-header">
                            <i class="fas fa-chart-bar me-1"></i>
                            카테고리별 평균 주문 수량과 총 매출 간의 관계
                        </div>
                        <div class="card-body">
                            <canvas id="myAllScatterChart" width="100%" height="40"></canvas>
                        </div>
                    </div>
                </div>

                <!-- 제품별 주문량과 재고 상태의 산포도 -->
                <div class="col-xl-12">
                    <div class="card mb-4">
                        <div class="card-header">
                            <i class="fas fa-chart-bar me-1"></i>
                            제품별 주문량과 재고 상태의 관계 분석
                        </div>
                        <div class="card-body">
                            <canvas id="myProductStockScatterChart" width="100%" height="40"></canvas>
                        </div>
                    </div>
                </div>

            </div>
            {% include 'fragment/footer.html' %}
            </div>
        </div>

        <!-- 산포도 차트를 그리기 위한 스크립트 -->
        <script>
            // 카테고리별 산포도 차트
            var ctxScatter = document.getElementById("myAllScatterChart").getContext("2d");
            var scatterData = {
                datasets: [{
                    label: 'Category Sales',
                    data: [
                        {% for category, total_sales in scatter_data %}
                        { x: "{{ category }}", y: {{ total_sales }} },
                        {% endfor %}
                    ],
                    backgroundColor: 'rgba(75, 192, 192, 0.4)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    pointRadius: 10
                }]
            };

            new Chart(ctxScatter, {
                type: 'scatter',
                data: scatterData,
                options: {
                    scales: {
                        x: {
                            type: 'category',
                            title: {
                                display: true,
                                text: 'Category'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Sales'
                            }
                        }
                    },
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    family: 'Arial'
                                }
                            }
                        }
                    }
                }
            });

            // 제품별 주문량과 재고 상태 차트
            var ctxProductStockScatter = document.getElementById("myProductStockScatterChart").getContext("2d");
            var productStockData = {
                datasets: [{
                    label: 'Product Stock and Orders',
                    data: [
                        {% for product in product_stock_order_data %}
                        { x: "{{ product.ProductName }}", y: {{ product.TotalOrderQuantity }} },
                        {% endfor %}
                    ],
                    backgroundColor: 'rgba(255, 99, 132, 0.4)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    pointRadius: 10
                }]
            };

            new Chart(ctxProductStockScatter, {
                type: 'scatter',
                data: productStockData,
                options: {
                    scales: {
                        x: {
                            type: 'category',
                            title: {
                                display: true,
                                text: 'Product'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Total Orders'
                            }
                        }
                    },
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    family: 'Arial'
                                }
                            }
                        }
                    }
                }
            });
        </script>
    </body>
</html>
